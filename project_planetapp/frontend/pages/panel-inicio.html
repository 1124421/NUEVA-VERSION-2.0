<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Panel Principal - Renacer</title>

  <!-- External dependencies -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://unpkg.com/lucide@latest"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
  <!-- Air Datepicker Calendar -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/air-datepicker@3.5.3/air-datepicker.min.css">
  <!-- Tom Select -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tom-select@2.4.1/dist/css/tom-select.min.css">

  <!-- Base Styles (Keep them here or move to a separate CSS) -->
  <link rel="stylesheet" href="../styles/panel.css">
  <link rel="stylesheet" href="../styles/asociado.css">
  <link rel="stylesheet" href="../styles/transactions.css">
  <link rel="stylesheet" href="../styles/materiales.css">
  <link rel="stylesheet" href="../styles/libraries-theme.css">
  <style>
    :root {
      --verde-renacer: #2d5a47;
      --verde-hover: #245239;
      --verde-light: #e8f5e9;
    }

    /* Chart specific styles remaining for now */
    .chart-card canvas {
      max-height: 180px !important;
    }
  </style>
</head>

<body>
  <!-- Session Guard: redirect if not logged in + prevent back-button -->
  <script>
    (function () {
      var userId = localStorage.getItem('user-id');
      var legacyUser = localStorage.getItem('planetapp_user');
      if (!userId && !legacyUser) {
        window.location.replace('../index.html');
        return;
      }
      history.replaceState(null, '', location.href);
      window.addEventListener('popstate', function () {
        history.pushState(null, '', location.href);
      });
    })();
  </script>
  <!-- Sidebar Shell (Content will be mounted by Sidebar component) -->
  <div class="sidebar"></div>

  <!-- Main Content Shell -->
  <div class="main-content">
    <div id="page-header"></div>
    <div id="dynamic-content">
      <!-- Pages will be mounted here by Router -->
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- Air Datepicker -->
  <script src="https://cdn.jsdelivr.net/npm/air-datepicker@3.5.3/air-datepicker.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/air-datepicker@3.5.3/locale/es.min.js"></script>
  <!-- Tom Select -->
  <script src="https://cdn.jsdelivr.net/npm/tom-select@2.4.1/dist/js/tom-select.complete.min.js"></script>

  <!-- Modular Application Entry Point -->
  <script type="module" src="../js/main.js"></script>

  <!-- ================= ACCESSIBILITY FILTERS ================= -->
  <svg style="position:absolute;width:0;height:0;" aria-hidden="true">
    <defs>
      <filter id="protanopia-filter">
        <feColorMatrix type="matrix"
          values="0.56667, 0.43333, 0, 0, 0 0.55833, 0.44167, 0, 0, 0 0, 0.24167, 0.75833, 0, 0 0, 0, 0, 1, 0" />
      </filter>
      <filter id="deuteranopia-filter">
        <feColorMatrix type="matrix" values="0.625, 0.375, 0, 0, 0 0.7, 0.3, 0, 0, 0 0, 0.3, 0.7, 0, 0 0, 0, 0, 1, 0" />
      </filter>
      <filter id="tritanopia-filter">
        <feColorMatrix type="matrix"
          values="0.95, 0.05, 0, 0, 0 0, 0.43333, 0.56667, 0, 0 0, 0.475, 0.525, 0, 0 0, 0, 0, 1, 0" />
      </filter>
    </defs>
  </svg>

  <script>
    // ========== GATEKEEPER CHECK ==========
    (function () {
      // If we didn't pass through index.html first in this browser session, force back.
      if (sessionStorage.getItem('gatekeeper-entry') !== 'true') {
        window.location.href = '../index.html';
        return;
      }

      // Accessibility Init
      const mode = localStorage.getItem('daltonismo-mode');
      if (mode && mode !== 'none') {
        document.documentElement.classList.add('daltonismo-' + mode);
      }
      const fontSize = localStorage.getItem('app-font-size');
      if (fontSize && parseInt(fontSize) !== 14) {
        document.documentElement.style.setProperty('--app-font-size', fontSize + 'px');
        document.documentElement.classList.add('app-font-custom');
      }
    })();
  </script>
</body>

</html>